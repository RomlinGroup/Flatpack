[
  {
    "type": "bash",
    "disabled": false,
    "code": "../bin/pip install --pre torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/nightly/cpu"
  },
  {
    "type": "bash",
    "disabled": false,
    "code": "if [ ! -d \"stable-diffusion-cpp\" ]; then\n    echo \"Directory 'stable-diffusion-cpp' does not exist.\"\n    \n    wget -nc -O sd-master-bin-Darwin-macOS-14.7.1-arm64.zip https://github.com/leejet/stable-diffusion.cpp/releases/download/master-9578fdc/sd-master--bin-Darwin-macOS-14.7.1-arm64.zip\n    \n    mkdir -p stable-diffusion-cpp\n    \n    unzip sd-master-bin-Darwin-macOS-14.7.1-arm64.zip -d stable-diffusion-cpp\nelse\n    echo \"Directory 'stable-diffusion-cpp' already exists.\"\nfi"
  },
  {
    "type": "bash",
    "disabled": false,
    "code": "cd stable-diffusion-cpp\nmkdir -p models\n\nif [ ! -f models/flux1-schnell-q4_k.gguf ]; then\n    wget -nc -O models/flux1-schnell-q4_k.gguf \"https://huggingface.co/leejet/FLUX.1-schnell-gguf/resolve/main/flux1-schnell-q4_k.gguf\"\nelse\n    echo \"Model already exist.\"\nfi\n\nif [ ! -f models/clip_l.safetensors ]; then\n    wget -nc -O models/clip_l.safetensors \"https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors\"\nelse\n    echo \"clip_l.safetensors exist.\"\nfi\n\nif [ ! -f models/diffusion_pytorch_model.safetensors ]; then\n    wget -nc -O models/diffusion_pytorch_model.safetensors \"https://huggingface.co/black-forest-labs/FLUX.1-schnell/resolve/main/vae/diffusion_pytorch_model.safetensors\"\nelse\n    echo \"diffusion_pytorch_model.safetensors exist.\"\nfi\n\nif [ ! -f models/t5xxl_fp16.safetensors ]; then\n    wget -nc -O models/t5xxl_fp16.safetensors \"https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp16.safetensors\"\nelse\n    echo \"t5xxl_fp16.safetensors exist.\"\nfi"
  },
  {
    "type": "bash",
    "disabled": false,
    "code": "echo \"$prompt\" > output.txt\n\nseed=$(od -An -N4 -i /dev/urandom | tr -d ' ')\ntimestamp=$(date +%Y%m%d_%H%M%S)\noutput_filename=\"output_${timestamp}_seed_${seed}.png\"\n\nif (( RANDOM % 2 )); then\n    width=768\n    height=1024\nelse\n    width=1024\n    height=768\nfi\n\necho \"Using seed: $seed\"\necho \"Output filename: $output_filename\"\necho \"Width: $width, Height: $height\"\n\nDYLD_LIBRARY_PATH=./ ./sd \\\n--cfg-scale 1.0 \\\n--clip_l ./models/clip_l.safetensors \\\n--diffusion-model ./models/flux1-schnell-q4_k.gguf \\\n--sampling-method euler \\\n--seed $seed \\\n--steps 4 \\\n--t5xxl ./models/t5xxl_fp16.safetensors \\\n--vae ./models/diffusion_pytorch_model.safetensors \\\n-p \"$prompt\" \\\n-H $height \\\n-W $width \\\n-o \"$output_filename\""
  }
]